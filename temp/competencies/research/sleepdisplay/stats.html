<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Page Template</title>
    <script type="text/javascript" src="d3.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <div class="row">
        <div class="column" id="col1"></div>
        <div class="column" id="col2"></div>
    </div> 
    <script type="text/javascript">
        var ndv = [
        "Aw4lsQ6KMMRE9u5Z7rrs6rbeXgx2",
        "Lz2rMwNMtuMSsXiUcpI9GiI24Gp1",
        "SMfHzD9jN1YtvNot6dMVNaz0bj43",
        "h4eRBbFNLggi0B0VL1VlKzSOthL2",
        "n9VCPXoxORQ1oannhWvOtD8md3J2",
        "WYBlm3JdMDZhgUzfNSlGrnXcueA2",
        "HGrkp5Wl5yeSLb5xRhv0R3klDgC2",
        "ndZOvfAVhdfvaG3xZMbzKoNV2Z72",
        "ivptwbfU29S3Bp09NUbx08JoLMl1", 
        "sapzNf1KnFf9AAZ2BNidriZmah02"
        ]

        var ntp = [
        "Dh2rOh7bCnMZQAfq95zzZQFdlY93",
        "GNyTPpwdungV0ZNuADEXOsRKe3V2",
        "nVGsEucgSbgDdiUiSLf4IzcXvi43",
        "DV7nGg7X2QedBi1JErxIG4vuT7L2",
        "JBCmPz3AxnfzcpXjIyIbAQ8SlWI2",
        "SqAVSkPyZ4gtfp83OH6RkDWYH3i1",
        "EF5SD7UQZlZEnm5F9ktrrWv8oFx1",
        "jYTVPHylFVdhwjRQsv3mhmTgbsg2",
        "fVzcQrnAiHbkiy6oNytqpceMl3n1",
        "KUtX80DmqEPwLn1Y6IAHXBpK3Mt2"
        ]

        var ntpjson = [];
        var ndvjson = [];

        var ndvheart = [];
        var ntpheart = [];


        var loadJson = async function(){
            for(var i=0; i<ndv.length; i++){
                d3.json("/sleep/"+ndv[i]+".json").then(function(obj){
                
                    d3.csv("/heartrate/"+obj.user_id+"_heart.csv").then(function(heart){
                        obj.heart = heart;
                    });
                    ndvjson.push(obj);

                });

            }

            for(var i=0; i<ntp.length; i++){
                d3.json("/sleep/"+ntp[i]+".json").then(function(obj){

                    d3.csv("/heartrate/"+obj.user_id+"_heart.csv").then(function(heart){
                        obj.heart = heart;
                    });

                    ntpjson.push(obj);
                });
            }
        }

        var tally_sleep = function(data){

            var millisleep = 0;

            data.forEach(function(obj){
                obj.sleep.forEach(function(sleep){
                    console.log("adding"+obj.user_id+" "+sleep.duration);
                    millisleep+= sleep.duration;
                })
            })

            return millisleep/3600000;
        }

        loadJson();

        var nthours;
        var ndhours;

        setTimeout(function(){
            nthours = tally_sleep(ntpjson);
            ndhours = tally_sleep(ndvjson);
        }, 2000);


        




    </script>



</body>
</html>
